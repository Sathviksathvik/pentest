#client.py
import time, socket, sys, hmac

key ="hello"
key1 =key.encode()
a = "stop"
a=a.encode()

print("\nWelcome to Chat Room\n")
print("Initialising....\n")
time.sleep(1)

s = socket.socket()
shost = socket.gethostname()
ip = socket.gethostbyname(shost)
a ="stop"
a = a.encode()
print(shost, "(", ip, ")\n")
host = input(str("Enter server address: "))
name = input(str("\nEnter your name: "))
port =  620
print("\nTrying to connect to ", host, "(", port, ")\n")
time.sleep(1)
s.connect((host, port))
print("Connected...\n")

s.send(name.encode())
s_name = s.recv(1024)
s_name = s_name.decode() 
print(s_name, "has joined the chat room\nEnter stop to exit chat room\n")

while True:
    message = input(str("Me : ")).encode()
    if message == a:
        
        s.close()
        print("\n")
        exit()
    hsh =hmac.new(key1,message,digestmod='sha512').hexdigest().encode()
    s.send(message)
    s.send(hsh)
    message = s.recv(1024)
    message = message.decode()
    print(s_name, ":", message)
    message = message.encode()
    hsh1=s.recv(1024)
    hshs2 =hmac.new(key1,message,digestmod='sha512').hexdigest().encode()
    if hsh1 != hshs2:
        s.close()
    



